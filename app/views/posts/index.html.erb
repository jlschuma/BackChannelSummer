
<%= form_tag("/posts", :method => "get") do %>
    <%= label_tag(:q, "Search for:") %>
    <%= text_field_tag(:searchString) %>
    <%= submit_tag("Search") %>
<% end %>

<h1>Listing posts</h1>

<% if current_user %>
    <ul>
    <li><%= link_to 'New Post', new_post_path %></li>
    </ul>
<% end %>
<table>
<thead>
  <tr>
    <th>Email</th>
    <th>Content</th>
    <th></th>
  </tr>
</thead>
<tbody>
  <% @postssorted = @posts.sort %>
  <% if @postssorted.empty? %>
    <tr>
      <td colspan="3">Sorry, there are no posts yet.</td>
    </tr>
  <% end %>
  <% @postssorted.each do |post| %>
      <tr>
        <td><%= post.user.email %></td>
        <td><%= post.body %></td>
        <td>
          <% if (current_user) %>
            <ul>
              <li><%= link_to 'Add Comment', post %></li>
              <% if (current_user.isAdmin?) %>
              <li><%= link_to 'Destroy', post, confirm: 'Are you sure?', method: :delete %></li>
              <% end %>
          <% end %>
        </td>
      </tr>
      <% post.comments.each do |comment| %>
          <tr>
            <td><%= comment.email %></td>
            <td><%= comment.body %></td>
            <td>
            <% if (current_user && current_user.isAdmin?) %>
              <ul>
                <li><%= link_to 'Destroy', [post, comment], confirm: 'Are you sure?', method: :delete %></li>
              </ul>
            <% end %>
            </td>
          </tr>
      <% end %>
  <% end %>
</tbody>
</table>